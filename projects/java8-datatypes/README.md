# Custom DataFormatConfigurator
Spring Boot Application using [Camunda](http://docs.camunda.org).

This project has been generated by the Maven archetype
[camunda-archetype-spring-boot-7.16.0](https://docs.camunda.org/manual/latest/user-guide/process-applications/maven-archetypes/).

## Show me the important parts!
This project shows how to overcome an issue with json Jackson serialization:

```
Cannot serialize object in variable 'anotherDate': SPIN/JACKSON-JSON-01009 Unable to map object 'DateObjectDTO [someDate=2021-12-17T13:42:20.660731600+01:00]' to json node


Caused by: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Java 8 date/time type `java.time.OffsetDateTime` not supported by default: add Module "com.fasterxml.jackson.datatype:jackson-datatype-jsr310" to enable handling (through reference chain: com.camunda.consulting.java8_datatypes.DateObjectDTO["someDate"])
```

## How does it work?

The Java Delegate sets a complex variable with an attribute of type `java.time.OffsetDateTime`. The `defaultSerializationFormat` is set to `application/json`. Camunda SPIN with the underlying JsonJackson implementation is not able to serialize this type by default. 

The github homepage from Fasterxml says, that you have to register modules on the `ObjectMapper`: https://github.com/FasterXML/jackson-modules-java8#registering-modules.

To do this in SPIN, you can provide a custom `DataFormtConfigurator`: [https://docs.camunda.org/manual/7.16/reference/spin/extending-spin/#configuring-data-formats](https://docs.camunda.org/manual/7.16/reference/spin/extending-spin/#configuring-data-formats)

Have a look at [MyDataFormatConfigurator](src/main/java/com/camunda/consulting/java8_datatypes/MadataFormatConfigurator.java) for the details.

The configurator is wired in the `META-INF/services/org.camunda.spin.spi.DataFormatConfigurator`.  

#### Spring Boot magic

You don't need the custom `DataFormatConfigurator` when you start the SpringBoot server.  

The logs for the ProcessUnitTest show outputs like

```
[main] INFO  org.camunda.spin - SPIN-01010 Discovered Spin data format provider: org.camunda.spin.impl.json.jackson.format.JacksonJsonDataFormatProvider[name = application/json]
[main] INFO  org.camunda.spin - SPIN-01011 Discovered Spin data format configurator: class org.camunda.bpm.spring.boot.starter.spin.CamundaJacksonFormatConfiguratorJSR310[dataformat = org.camunda.spin.impl.json.jackson.format.JacksonJsonDataFormat]
[main] INFO  org.camunda.spin - SPIN-01011 Discovered Spin data format configurator: class org.camunda.bpm.spring.boot.starter.spin.CamundaJacksonFormatConfiguratorParameterNames[dataformat = org.camunda.spin.impl.json.jackson.format.JacksonJsonDataFormat]
[main] INFO  org.camunda.spin - SPIN-01011 Discovered Spin data format configurator: class org.camunda.bpm.spring.boot.starter.spin.CamundaJacksonFormatConfiguratorJdk8[dataformat = org.camunda.spin.impl.json.jackson.format.JacksonJsonDataFormat]
```

Here all available modules are picked up from the classpath automatically. But if you register them as shown above, they don't harm.

## How to use it?

### Unit Test
You can run the JUnit test [InMemoryH2Test](src/test/java/com/camunda/consulting/java8_datatypes/InMemoryH2Test.java) in your IDE or using:

```bash
mvn clean test
```

### Running the application
You can also build and run the process application with Spring Boot.

#### Manually
1. Build the application using:

```bash
mvn clean package
```
2. Run the *.jar file from the `target` directory using:

```bash
java -jar target/java8-datatypes.jar
```

For a faster 1-click (re-)deployment see the alternatives below.

#### Maven Spring Boot Plugin
1. Build and deploy the process application using:

```bash
mvn clean package spring-boot:run
```

#### Your Java IDE
1. Run the project as a Java application in your IDE using CamundaApplication as the main class.

### Run and Inspect with Tasklist and Cockpit
Once you deployed the application you can run it using
[Camunda Tasklist](http://docs.camunda.org/latest/guides/user-guide/#tasklist)
and inspect it using
[Camunda Cockpit](http://docs.camunda.org/latest/guides/user-guide/#cockpit).

## Environment Restrictions
Built and tested against Camunda Platform version 7.16.0.

## Known Limitations

## License
[Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0).

<!-- Tweet
New @Camunda example: Camunda Spring Boot Application - Spring Boot Application using [Camunda](http://docs.camunda.org). https://github.com/camunda-consulting/code/tree/master/snippets/java8-datatypes
-->
